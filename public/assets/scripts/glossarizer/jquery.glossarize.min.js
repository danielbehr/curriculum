
(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{if(typeof exports==="object"&&typeof require==="function"){a(require("jquery"))}else{a(jQuery)}}}(function(e){var d="glossarizer",f={sourceURL:"",replaceTag:"abbr",lookupTagName:"p, ul, a, div",callback:null,replaceOnce:false,replaceClass:"glossarizer_replaced",caseSensitive:false,exactMatch:false};function c(m,k){var o=this;o.el=m;o.$el=e(m);o.options=e.extend({},f,k);o.terms=[];o.excludes=[];o.replaced=[];o.regexOption=(o.options.caseSensitive?"":"i")+(o.options.replaceOnce?"":"g");o.glossary=this.options.sourceURL;if(!o.glossary.length||o.glossary.length==0){return}for(var l=0;l<o.glossary.length;l++){var n=o.glossary[l].title.split(",");for(var h=0;h<n.length;h++){var p=n[h].replace(/^\s+|\s+$/g,""),g=p.indexOf("!");if(g==-1||g!=0){o.terms.push(p)}else{o.excludes.push(p.substr(1))}}}o.wrapTerms()}c.prototype={getDescription:function(j){var h=new RegExp("(,|s*)"+this.clean(j)+"\\s*|\\,$","i");for(var g=0;g<this.glossary.length;g++){if(this.options.exactMatch){if(this.glossary[g].title==this.clean(j)){return this.glossary[g].content.replace(/\"/gi,"&quot;")}}else{if(this.glossary[g].title.match(h)){return this.glossary[g].content.replace(/\"/gi,"&quot;")}}}},clean:function(h){var g=new RegExp("(\\"+["/",".","*","+","?","(",")","[","]","{","}","\\"].join("|\\")+")","g");return h.replace(g,"\\$1")},wrapTerms:function(){this.cleanedTerms=this.clean(this.terms.join("|"));this.excludedTerms=this.clean(this.excludes.join("|"));var g=this.el.querySelectorAll(this.options.lookupTagName);for(var h=0;h<g.length;h++){this.traverser(g[h])}if(this.options.callback){this.options.callback.call(this.$el)}},traverser:function(j){var i,l=this;if(j.nodeType===1){if(j=j.firstChild){do{i=j.nextSibling;if(j.className!=this.options.replaceClass){this.traverser(j)}}while(j=i)}}else{if(j.nodeType===3){var g=document.createElement("div"),k=j.data;var h=new RegExp("(?:^|\\b)("+this.cleanedTerms+")(?!\\w)",l.regexOption),m=new RegExp("(?:^|\\b)("+this.excludedTerms+")(?!\\w)",l.regexOption);if(h.test(k)){var n=m.exec(k);k=k.replace(h,function(q,v,p,t){if(l.options.replaceOnce&&a(q,l.replaced)>=0){return q}l.replaced.push(q);var s=new RegExp("(?:^|\\b)"+l.clean(q)+"(?!\\w)"),w=s.exec(k);if(w){if(n&&l.excludes.length){var o=p,u=n.index,r=n.index+n[0].length;if(u<=o&&o<=r){return q}else{return"<"+l.options.replaceTag+' class="'+l.options.replaceClass+'" title="'+l.getDescription(q)+'">'+q+"</"+l.options.replaceTag+">"}}else{return"<"+l.options.replaceTag+' class="'+l.options.replaceClass+'" title="'+l.getDescription(q)+'">'+q+"</"+l.options.replaceTag+">"}}});e(g).html(k);while(g.firstChild){j.parentNode.insertBefore(g.firstChild,j)}j.parentNode.removeChild(j)}}}},};var b={destroy:function(){this.$el.removeData("plugin_"+d);this.$el.find("."+this.options.replaceClass).each(function(){var g=e(this),h=g.text();g.replaceWith(h)})}};c.prototype=e.extend({},c.prototype,b);e.fn[d]=function(g){return this.each(function(){var i=e(this),h=i.data("plugin_"+d);if(typeof g=="string"&&h&&b.hasOwnProperty(g)){h[g].apply(h)}else{if(h){h.destroy.apply(h)}e.data(this,"plugin_"+d,new c(this,g))}})};function a(k,h,j){if(typeof k!=="string"){return e.inArray.apply(this,arguments)}if(h){var g=h.length;j=j?(j<0?Math.max(0,g+j):j):0;k=k.toLowerCase();for(;j<g;j++){if(j in h&&h[j].toLowerCase()==k){return j}}}return -1}}));